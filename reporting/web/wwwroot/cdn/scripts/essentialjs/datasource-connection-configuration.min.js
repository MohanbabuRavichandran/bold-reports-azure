/*!
*  filename: datasource-connection-configuration.min.js
*  version : unknown version
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ej;(function(n){var t;(function(t){var r,i,u;(function(n){n[n.After=0]="After";n[n.Before=1]="Before"})(r=t.LabelPosition||(t.LabelPosition={})),function(n){n[n.Database=0]="Database";n[n.File=1]="File";n[n.Services=2]="Services";n[n.CustomConnectors=3]="CustomConnectors"}(i||(i={})),function(n){n[n.Database="Databases"]="Database";n[n.File="Files"]="File";n[n.Services="Service Connectors"]="Services";n[n.CustomConnectors="Custom Connectors"]="CustomConnectors"}(u||(u={}));var f=function(){function n(){}return n}(),o=function(){function n(){}return n}(),s=function(){function n(){}return n}(),e=function(t){function e(i,r){var u=t.call(this)||this;return u.pluginName="ejConnectionConfiguration",u._id=$(u.element).attr("id"),u.model=null,u.scrollerSize={scrollSize:5,buttonSize:0},u.defaults={serviceUrl:null,reportServerUrl:null,serviceAuthorizationToken:"",locale:"en-US",connection:{connectionList:[],oAuthConnections:[]}},u.configurationContainer=null,u.contentWrap=null,u.contentContainer=null,u.totalTilesInfo=[],u.searchText="",u.availableDSList=[],u.id="",u.codeChkSwitcher=null,u.dialogContainer=null,u.progressTxt=null,u.filePath=null,u.saveButton=null,u.isDialogSave=!1,i&&(i.jquery||(i=$("#"+i)),i.length&&(n.isNullOrUndefined(r)||($(i).addClass("e-reportdesigner"),$(i).ejConnectionConfiguration(r).data(u.pluginName)))),u}return __extends(e,t),e.prototype._init=function(){this.configurationContainer=n.buildTag("div.e-rpt-connection-mode-dlg e-connection-configuration-container","",{},{});this.element.append(this.configurationContainer);this._id=$(this.element).attr("id");this.configurationContainer.ejWaitingPopup({showOnInit:!1,cssClass:"e-designer-waitingpopup "+this._id+"_designer_waiting_popup e-designer-loader"});this.getDatasourceTypes()},e.prototype.getConnectionInfo=function(){this.util.doAjaxPost("GET",this.model.serviceUrl+EJQueryEnum.ServiceAPI.connectionSettings,{},{fnction:$.proxy(this.updateConnectionInfo,this),indicator:[$.proxy(this.showIndicator,this),$.proxy(this.hideIndicator,this)]})},e.prototype.showIndicator=function(){var t=this.configurationContainer.data("ejWaitingPopup");n.isNullOrUndefined(t)||t.show()},e.prototype.hideIndicator=function(){var t=this.configurationContainer.data("ejWaitingPopup");n.isNullOrUndefined(t)||t.hide()},e.prototype.updateConnectionInfo=function(t){n.isNullOrUndefined(t)||n.isNullOrUndefined(t.data)||!t.status?n.isNullOrUndefined(t)||t.status||this.util.ejAlertDialog("ReportDesigner",t.message?t.message:"Failed to update connection info",!1,!1,!1,"",null):(this.model.connection.connectionList=t.data.connectionList,this.renderConfigurationListContainer())},e.prototype.saveConnectionInfo=function(t){var i=this.updateTilesInfoInModel();i&&(n.isNullOrUndefined(t)||this.util.doAjaxPost("POST",this.model.serviceUrl+EJQueryEnum.ServiceAPI.connectionSettings,{data:JSON.stringify(this.model.connection)},{fnction:$.proxy(this.onConnectionDetailsSuccess,this)}))},e.prototype.onConnectionDetailsSuccess=function(t){!n.isNullOrUndefined(t)&&t.status?this._trigger("actionComplete",{eventType:"afterSaveConnection",data:t}):n.isNullOrUndefined(t)||t.status||this.util.ejAlertDialog("ReportDesigner",t.message?t.message:"Failed to save the connection list details",!1,!1,!0,"",null)},e.prototype.updateTilesInfoInModel=function(){var t=this,n=this.totalTilesInfo.filter(function(n){return n.switchBtnChkState===!0});return n.length>0?(this.model.connection.connectionList=[],n.forEach(function(n){t.model.connection.connectionList.push(n.connector)}),!0):(this.util.ejAlertDialog("ReportDesigner","Please select minimum one connection.",!1,!1,!0,"",null),!1)},e.prototype.renderConfigurationListContainer=function(){this.renderConnectionList();this.configurationContainer.append(this.getHeader(),this.contentWrap);this.unwireEvents();this.wireEvents()},e.prototype.getHeader=function(){var t=n.buildTag("div.e-connection-configuration-header","",{});return t.append("<div class='e-con-header-search-wrap'><div class='e-con-header-search-box'><\/div><\/div>"),this.renderSearchBox(t.find(".e-con-header-search-box")),t},e.prototype.renderSearchBox=function(n){n.append(this.renderDataSourceSearchOptions())},e.prototype.renderConnectionList=function(){this.contentWrap=n.buildTag("div.e-connection-configuration-content-container e-rpt-connection-mode-content-wrap e-rpt-control e-rpt-designer-scroll-style-3","",{},{});this.contentContainer=n.buildTag("div.e-rpt-connection-mode-content-container","",{},{});this.contentWrap.append(this.contentContainer);this.totalTilesInfo=this.convertTilesInfoFormat(this.availableDSList);this.renderTilesByCategory(this.totalTilesInfo)},e.prototype.convertTilesInfoFormat=function(t){for(var f=!n.isNullOrUndefined(this.model.connection.connectionList)&&this.model.connection.connectionList.length>0?this.model.connection.connectionList:[],e=[],u=0;u<t.length;u++){var r=t[u],o=n.isNullOrUndefined(r.connectorsCategory)?i.Services:r.connectorsCategory,s=f.length===0?!0:f.indexOf(r.connector)!==-1;e.push({id:r.id,iconClassName:r.src+"-tile",category:o,name:r.name,connector:r.connector,description:r.description,itemType:r.itemType,switchBtnChkState:s,isSwitchBtnDisable:!1})}return e},e.prototype.renderTilesByCategory=function(t){for(var f=this.getCategoryNameList(),r=0;r<f.length;r++){var h=this.util.stringtoEnum(i,f[r]),o=this.getCategoryBasedTileInfo(f[r],t),s=n.buildTag("div.e-tile-category-container","",{},{"data-category":f[r]}),e=n.buildTag("div.e-rpt-tile-container","",{},{"data-category":f[r]});this.renderCategoryHeader(u[f[r]],o,f[r],s);s.append(e);h===i.CustomConnectors&&this.fetchCustomConnectors();o.length>0&&this.renderTiles(f[r],o,e);e.css({"max-height":this.getContentHeight(e)+"px"});this.contentContainer.append(s)}},e.prototype.getCategoryNameList=function(){for(var t,u,f=[],e=Object.keys(i),r=0;r<e.length;r++)t=e[r],u=n.parseInt(t,10)>=0,u&&f.push(i[t]);return f},e.prototype.getCategoryBasedTileInfo=function(n,t){var r=this;return t.filter(function(t){return t.category===r.util.stringtoEnum(i,n)})},e.prototype.renderCategoryHeader=function(n,t,i,r){var u=t.filter(function(n){return n.switchBtnChkState===!0}).length,f=t.length,o="<div class ='e-con-tile-header-wrap'><div class='e-category-text-wrap'><div class='e-rpt-tile-container-title'>"+n+"<\/div><\/div><div class='e-category-selection'><div class='e-con-selection-text'><span class ='e-con-config-selection-count'>"+u+"<\/span> of "+f+" selected<\/div ><div class='e-con-selection-chkbox'><\/div><div class='e-category-icon-wrap'><div class='e-category-icon e-tile-container-expand'><\/div><\/div><\/div><\/div>",e;r.append(o);e=this.isCategorySelectionDisable(t);this.renderCheckBox(r.find(".e-con-selection-chkbox"),i,u,f,e)},e.prototype.isCategorySelectionDisable=function(n){var t=n.filter(function(n){return n.isSwitchBtnDisable===!0});return t.length===n.length},e.prototype.renderCheckBox=function(n,t,i,u,f){var e={callBackInstance:this,callBackMethod:"checkBoxOnValueChange",cssClass:"e-config-check-box",dataSource:[{id:this._id+"_chkbox_"+t,name:t,isChecked:i===0?!1:u===i,enableTriState:i>0&&i<u,label:"EnableAll"}],labelPosition:r.After};this.renderCheckBoxhButton(e,n);this.disableItemByName(t,f)},e.prototype.checkBoxOnValueChange=function(n){var t=this,i=$(n.event.event.currentTarget).parents(".e-tile-category-container"),r=i.find(".e-con-tile-wrap .e-con-switch-btn");r.each(function(i,r){var f=$(r),u=f.parents(".e-con-tile-wrap ");t.updateSwitchValueByName(u.attr("data-tile-name"),n);t.switchStateUpdate(n.event.isChecked,u)});this.updateSelectedItemsCountText(i)},e.prototype.updateSwitchValueByName=function(n,t){var f=$(t.event.event.currentTarget),i=f.parents(".e-tile-category-container").find(".e-rpt-swt-input[name ='"+n+"']"),r=i.parents(".e-con-tile-wrap"),u=t.event.isChecked;i&&(this.switchStateUpdate(u,r),this.updateSelectedItemsCountText(r.parents(".e-tile-category-container"),!0),i.prop("checked",u))},e.prototype.updateSelectedItemsCountText=function(n,t){t===void 0&&(t=!1);var i=this.getCategoryBasedTileInfo(n.attr("data-category"),this.totalTilesInfo),r=i.filter(function(n){return n.switchBtnChkState===!0});n.find(".e-con-tile-header-wrap .e-con-config-selection-count").text(r.length);t&&this.chkStateSwitchSelection(i.length,r.length,n)},e.prototype.chkStateSwitchSelection=function(n,t,i){var r=t===0?!1:n===t,u=t>0&&t<n;this.checkItemByName(i,r);this.intermediateStateByName(i,u)},e.prototype.renderTiles=function(t,i,r,u){var f,e;if(u===void 0&&(u=!1),!n.isNullOrUndefined(r))for(f=0;f<i.length;f++)e=this.getTiles(i[f],u),r.append(e)},e.prototype.getTiles=function(t,r,u){r===void 0&&(r=!1);u===void 0&&(u=!1);var e=t.switchBtnChkState?" e-con-select":"",f=n.buildTag("div.e-con-tile-wrap e-rpt-service-tile-wrap"+e,"",{},{"data-category":this.util.enumToString(i,t.category),"data-tile-name":t.name,"data-connector":t.connector,id:this._id+t.id});return r?(f.append(this.renderTileNameForCustomConnectors(t.iconClassName,t.name)),f.css("height","150px")):f.append(this.getSwitchBtn(t),this.getConnectionTileImage(t.iconClassName)),f.append(this.getConfigureBtn()),f},e.prototype.getConfigureBtn=function(){return"<button class='e-con-tile-configure-btn'>Add New Connector<\/button>"},e.prototype.renderTileNameForCustomConnectors=function(t,i){var r=n.buildTag("div.e-custom-connector-tile-parent","",{height:"100%",display:"flex","flex-direction":"column"},{}),f=n.buildTag("div.e-custom-web-designer",i,{"text-align":"center",margin:"0px 27.5px 10px 27.5px","font-size":"12px","line-height":"32px",color:"#808080",overflow:"hidden","word-break":"break-all"});r.append(this.getConnectionTileImage(t),f);var u=n.buildTag("div","",{display:"flex","flex-direction":"row",float:"right"}),e=n.buildTag("div.e-custom-connector-delete","",{},{"data-custom-connector-name":i}),o=n.buildTag("div.e-custom-connector-edit","",{},{"data-custom-connector-name":i});return u.append(o,e),r.find(".e-rpt-tile-icon-wrap").append(u),r},e.prototype.onCustomConnectorDelete=function(t){var r=$(t.target),i=r.attr("data-custom-connector-name");n.ReportUtil.isEmptyString(i)||this.deleteCustomConnector(i)},e.prototype.onCustomConnectorEdit=function(t){var r=$(t.target),i=r.attr("data-custom-connector-name");n.ReportUtil.isEmptyString(i)||(this.renderDialog(i),this.ejUploadBox.model.saveUrl=this.model.serviceUrl+EJQueryEnum.ServiceAPI.uploadCustomConnectorJson+"/"+i)},e.prototype.deleteCustomConnector=function(n){this.util.doAjaxPost("DELETE",this.model.serviceUrl+EJQueryEnum.ServiceAPI.customConnectorDelete+"/"+n,{},{fnction:$.proxy(this.removeCustomConnectorTile,this,n)})},e.prototype.removeCustomConnectorTile=function(t,r){if(!n.isNullOrUndefined(r)&&r.status){this.contentContainer.find(".e-rpt-service-tile-wrap[data-tile-name="+n.ReportUtil.escapeSelector(t)+"]").remove();var u=this.totalTilesInfo.filter(function(n){return n.name===t&&n.category===i.CustomConnectors});this.totalTilesInfo.splice(this.totalTilesInfo.indexOf(u[0]),1)}else n.isNullOrUndefined(r)||r.status||this.util.ejAlertDialog("Upload Failed",r?r.message:null,!1,!1,!0,"",null)},e.prototype.getSwitchBtn=function(t){var i=n.buildTag("div.e-con-switch-btn","",{},{id:this._id+"_tile_switch-btn_wrap_"+t.name});return this.createSwitchBtn(i,t),i},e.prototype.createSwitchBtn=function(t,i){this.switchBtnInfo={callBackInstance:this,callBackMethod:"switchBtnOnValueChange",checkState:i.switchBtnChkState,id:this._id+"_switchBtn_"+i.name,name:i.name,cssClass:"e-config-switch-btn"};var u=n.buildTag("div.e-dataconnector-code-switcher e-rptdesigner-tab-focus","",{},{id:this._id+"_design_switcher",tabindex:"0",role:"button"}),r=n.buildTag("label.e-dataconnector-switch","",{display:"inline-block",float:"left"},{id:this._id+"_code_switcher"}),f=this.getId(this.switchBtnInfo);this.codeChkSwitcher=$("<input type='checkbox' id="+f+"_swt_input' class='e-rpt-swt-input' name='"+this.switchBtnInfo.name+"'>");r.append(this.codeChkSwitcher);r.append("<div style='cursor:pointer;' class='e-dataconnector-slider round'><\/div>");u.append(r);t.append(u);this.codeChkSwitcher.bind("change",$.proxy(this.switcherChanged,this));this.enableSwitcher()},e.prototype.enableSwitcher=function(){this.switchBtnInfo&&this.codeChkSwitcher.prop("checked",this.switchBtnInfo.checkState)},e.prototype.getId=function(t){var i=n.isNullOrUndefined(t.id)?this.targetContainer.attr("id")+"_input_":t.id;return i.replace(/ /g,"_")},e.prototype.switcherChanged=function(n){var f={args:n,optionalArgs:this.switchBtnInfo.optionalArgs},t=$(f.args.currentTarget),r=t.is(":checked"),i=t.parents(".e-con-tile-wrap"),u;t&&(this.switchStateUpdate(r,i),i.attr("data-connector")==="Custom-Connector"&&(u=t.parents(".e-rpt-tile-container"),this.updateCustomConnectorTiles(r,u)),this.updateSelectedItemsCountText(i.parents(".e-tile-category-container"),!0))},e.prototype.updateCustomConnectorTiles=function(t,r){var u=this,f=this.totalTilesInfo.filter(function(n){return n.category===i.CustomConnectors});f.forEach(function(i){return u.switchStateUpdate(t,r.find(".e-con-tile-wrap[data-connector="+n.ReportUtil.escapeSelector(i.connector)+"]"))})},e.prototype.switchStateUpdate=function(n,t){this.updateTileInfo(t,n);n?t.addClass("e-con-select"):t.removeClass("e-con-select")},e.prototype.updateTileInfo=function(n,t){var i=this.totalTilesInfo.filter(function(t){return t.connector===n.attr("data-connector")});i.length>0&&(i[0].switchBtnChkState=t)},e.prototype.getConnectionTileImage=function(t){var i=n.browserInfo().name==="webkit"?t+" e-rpt-safari-compatability  e-rpt-connection-img-tile":t+" e-rpt-connection-img-tile";return"<div class='e-rpt-tile-icon-wrap "+i+"'><\/div>"},e.prototype.onCatergoryIconClick=function(n){var t=$(n.currentTarget),f=t.hasClass("e-category-text-wrap"),i=t.parents(".e-tile-category-container"),e=i.find(".e-category-icon"),r,u;f&&(t=e);r=t.hasClass("e-tile-container-expand");t.removeClass(r?"e-tile-container-expand":"e-tile-container-collapse").addClass(r?"e-tile-container-collapse":"e-tile-container-expand");r?i.find(".e-rpt-tile-container").css("max-height","0px"):(u=this.getContentHeight(i.find(".e-rpt-tile-container")),i.find(".e-rpt-tile-container").css("max-height",u+"px"));this.scrollerTimer&&clearTimeout(this.scrollerTimer)},e.prototype.getContentHeight=function(n){var t=n.clone().css({position:"absolute",visibility:"hidden",height:"auto","max-height":"",width:"calc(100% - 84px)",padding:"0px 42px"}),i;return this.configurationContainer.append(t),i=t.innerHeight(),t.remove(),i},e.prototype.renderSelectedCategoryItems=function(t){var i,r;this.contentContainer.empty();i=this.fetchCurrentStatusOfSearchCategory(t);i.length>0?this.renderTilesByCategory(i):(r=n.buildTag("div.e-rpt-tile-container",this.getNoItemMsg(),{},{}),this.contentContainer.append(r))},e.prototype.fetchCurrentStatusOfSearchCategory=function(n){for(var i=[],r=function(t){var r=u.totalTilesInfo.filter(function(i){return i.id===n[t].id});r.length>0&&i.push(r[0])},u=this,t=0;t<n.length;t++)r(t);return i},e.prototype.renderDataSourceSearchOptions=function(){return"<div class='e-con-search-wrap'><div class='e-rpt-designer-datasource-category-container'><div class='e-rpt-designer-datasource-search-container'><input type='text' id='"+this._id+"_datasource_list_search' class='e-autocomplete e-rpt-designer-font e-rpt-designer-search-box e-js e-input' placeholder='Search Connector'/><span id='"+this._id+"_datasource_list_search_icon' style='margin-top:-18px;margin-right:6px;float:right' class='e-rptdesigner-headericon e-reportdesigner-search'><\/span><\/div><\/div>"},e.prototype.onDataSourceSearchTextFocusIn=function(n){var t=$(n.currentTarget.parentElement);t.addClass("e-focus")},e.prototype.onDataSourceSearchTextFocusOut=function(n){var t=$(n.currentTarget.parentElement);t.hasClass("e-focus")&&t.removeClass("e-focus")},e.prototype.onDataSourceClearIconClick=function(n){var t=$(n.currentTarget);t.removeClass("e-reportdesigner-close").addClass("e-reportdesigner-search");t.siblings(".e-autocomplete").val("");this.searchText="";this.renderDsTypeList()},e.prototype.onDataSourceSearchKeyPress=function(n){this.dataSourceSearchTimer!==-1&&(clearTimeout(this.dataSourceSearchTimer),this.dataSourceSearchTimer=-1);var t=this;this.dataSourceSearchTimer=setTimeout(function(){var i=$(n.currentTarget);t.searchText=i.val();t.searchText.trim()===""?i.siblings(".e-rptdesigner-headericon").removeClass("e-reportdesigner-close").addClass("e-reportdesigner-search"):i.siblings(".e-rptdesigner-headericon").addClass("e-reportdesigner-close").removeClass("e-reportdesigner-search");t.renderDsTypeList()},500)},e.prototype.renderDsTypeList=function(){this.generateDataSourceTypes(this.contentWrap.find(".e-rpt-connection-mode-content-container"))},e.prototype.generateDataSourceTypes=function(n){var t=this.getDsItems();this.renderDsSelectedElements(t,n)},e.prototype.renderDsSelectedElements=function(n,t){n.length===0&&t.append(this.getNoItemMsg());this.renderSelectedCategoryItems(n)},e.prototype.initializeDesigner=function(){var n={serviceUrl:this.model.serviceUrl+"/api/Designer",serviceAuthorizationToken:this.model.serviceAuthorizationToken,reportServerUrl:this.model.reportServerUrl},t=new boldReportDesigner($("#container"),n);return this.util=this.getInstance("ReportUtil"),t},e.prototype.getInstance=function(t){if(t==="ReportUtil")return(this.util===null||this.util===undefined)&&(this.util=new n.ReportUtil(this)),this.util},e.prototype.datasourceCallback=function(n){this.availableDSList=this.sortCollection(n,"name");this.getConnectionInfo()},e.prototype.renderDialog=function(t){this.dialogContainer=n.buildTag("div","",{},{id:this._id+"_upload_Container"});this.element.append(this.dialogContainer);this.saveButton=n.buildTag("button.e-rptdesigner-okbtn","Save",{float:"right",height:"28px","margin-right":"10px"},{id:this._id+"_save_btn"});var i=n.buildTag("button.e-rptdesigner-cancelbtn","Cancel",{float:"right",height:"28px"},{id:this._id+"_cancel_btn"});this.dialogContainer.ejDialog({width:"auto",height:"auto",minWidth:315,minHeight:260,title:"JSON Upload",enableResize:!1,showOnInit:!0,showFooter:!0,containment:"#"+this._id,target:"#"+this._id,cssClass:"e-rptdesigner-dialog",enableModal:!0,close:$.proxy(this.closeCustomConnectorDialog,this),closeIconTooltip:"Close"});this.element.find("#"+this._id+"_upload_Container_foot").append(i,this.saveButton);this.renderUploadContainer();n.isNullOrUndefined(this.ejUploadBox)&&this.renderUploadBox();this.saveButton.attr("disabled","disabled");i.on("click",$.proxy(this.onCancelClick,this));if(n.ReportUtil.isEmptyString(t))this.saveButton.on("click",$.proxy(this.saveCustomConnector,this));else this.saveButton.on("click",$.proxy(this.editCustomConnector,this,t))},e.prototype.saveCustomConnector=function(){this.util.doAjaxPost("POST",this.model.serviceUrl+EJQueryEnum.ServiceAPI.saveCustomConnector+"/"+this.customConnectorFileName,{},{fnction:$.proxy(this.onCustomConnectorSave,this)})},e.prototype.editCustomConnector=function(n){this.util.doAjaxPost("POST",this.model.serviceUrl+EJQueryEnum.ServiceAPI.customConnectorEdit,{data:JSON.stringify({previousConnector:n,currentConnectorFile:this.customConnectorFileName})},{fnction:$.proxy(this.onEditCustomConnector,this,n)})},e.prototype.onEditCustomConnector=function(t,i){i.status?(this.isDialogSave=!0,this.dialogContainer.ejDialog("close"),n.isNullOrUndefined(i.data)||n.isNullOrUndefined(i.data.connectionInfo)||this.editCustomConnectorTile(t,i.data.connectionInfo)):this.util.ejAlertDialog("File Upload",i?i.Message:null,!1,!1,!0,"",null);this.customConnectorFileName=""},e.prototype.onCustomConnectorSave=function(t){t.status?(this.isDialogSave=!0,this.dialogContainer.ejDialog("close"),n.isNullOrUndefined(t.data)||n.isNullOrUndefined(t.data.connectionInfo)||this.renderTilesForCustomConnector(t.data.connectionInfo)):this.util.ejAlertDialog("File Upload",t?t.Message:null,!1,!1,!0,"",null);this.customConnectorFileName=""},e.prototype.renderTilesForCustomConnector=function(n){var r=this.contentContainer.find(".e-rpt-tile-container[data-category="+i[3]+"]"),t=new f;t.category=i.CustomConnectors;t.isSwitchBtnDisable=!1;t.connector="WebAPI_"+n.name;t.iconClassName="e-reportdesigner-datasource-webapi-tile";t.id="_custom_webDs";t.itemType="e-web";t.name=n.name;t.description=n.description;t.switchBtnChkState=!0;r.append(this.getTiles(t,!0));this.totalTilesInfo.push(t);this.updateDeleteIcon(r)},e.prototype.editCustomConnectorTile=function(t,r){var o=this.contentContainer.find(".e-rpt-tile-container[data-category="+i[3]+"]"),f=o.find(".e-con-tile-wrap[data-tile-name="+n.ReportUtil.escapeSelector(t)+"]"),u,e;n.isNullOrUndefined(f)||(u=this.totalTilesInfo.filter(function(n){return n.name===t})[0],u.connector="WebAPI_"+r.name,f.find(".e-custom-connector-tile-parent").remove(),f.attr("data-tile-name",n.ReportUtil.escapeSelector(r.name)),f.attr("data-connector",n.ReportUtil.escapeSelector(u.connector)),u.name=r.name,u.description=r.description,f.append(this.renderTileNameForCustomConnectors(u.iconClassName,u.name)),e=this.totalTilesInfo.indexOf(u),this.totalTilesInfo.splice(e,1),this.totalTilesInfo.splice(e,0,u),this.updateDeleteIcon(o))},e.prototype.renderUploadContainer=function(){var e=n.buildTag("table.e-designer-dsconfig-table","",{width:"100%","margin-left":"6px"},{unselectable:"on",id:this._id+"_file_local_table"}),o=n.buildTag("tr","",{}),s=n.buildTag("td","",{}),i=n.buildTag("table","",{unselectable:"on"}),h=n.buildTag("tr","",{},{}),r=n.buildTag("tr","",{},{}),w=n.buildTag("td","",{float:"right"},{id:this._id+"_fileDatasource_path_error_icon_td"}),c=n.buildTag("td","",{},{colspan:"2"}),b=n.buildTag("label.editLabel e-designer-title-label","File Path",{}),u,f,t,l;this.progressTxt=n.buildTag("label.editLabel e-designer-title-label e-rptdesigner-txtoverflow","",{float:"left"});var k=n.buildTag("label.editLabel e-designer-tile-content e-rptdesigner-btn-max-size e-rptdesigner-txtoverflow","Max file size: 200 MB",{float:"right","font-size":"12px","padding-right":"6px"}),d=n.buildTag("label.editLabel e-designer-tile-content","<b>Note<\/b> : Larger files will take more time to import",{},{"class":"e-onpremise-file-warning-text"}),a=n.buildTag("td","",{float:"left"}),v=n.buildTag("tr","",{height:"22.5px"},{id:this._id+"_fileDatasource_path_td"}),y=n.buildTag("tr.e-progresserrmsg","",{height:"22.5px",display:"none"},{id:this._id+"_progresserr_tr"}),p=n.buildTag("td","",{}),g=n.buildTag("label.editLabel","Upload",{"font-size":"12px","font-weight":"normal"},{});a.append(b);u=n.buildTag("td","",{},{});f=n.buildTag("td","",{},{});this.filePath=n.buildTag("input.e-textbox e-designer-content-label e-rptdesigner-exclude","",{height:"29px","border-right":"0px","padding-bottom":"0.5px","padding-top":"0.5px",width:"427px","margin-left":"1px"},{id:this._id+"_fileDatasource_path",type:"text",readonly:"readonly"});t=n.buildTag("div.e-designer-content-label e-rptdesigner-format-btn e-rptdesigner-tab-focus e-rptdesigner-btn-secondary","",{display:"inline-block","margin-left":"-53px","vertical-align":"middle","min-width":"0",padding:"0px 12px"},{id:this._id+"_file_datasource_browse"});l=n.buildTag("span.e-reportdesigner-horizontal-browse e-rptdesigner-browse-icon","",{"font-size":"16px","margin-top":"3px"});c.append(this.progressTxt,k);u.append(this.filePath);f.append(t);t.append(l);v.append(u,f);h.append(a,w);i.append(h,v,r.clone(),r,d);r.append(c);e.append(o);o.append(s);s.append(i);p.append(g);y.append(p);i.append(y);this.dialogContainer.append(e);t.on("click",$.proxy(this.onBrowseClick,this))},e.prototype.onBrowseClick=function(){this.ejUploadBox.setModel({extensionsAllow:".json"});this.element.find("#"+this._id+"_fileDatasource_upload .e-uploadinput").click()},e.prototype.closeCustomConnectorDialog=function(t){n.ReportUtil.closeDialog(t);this.filePath.val("");this.progressTxt.text("");this.customConnectorFileName===""||this.isDialogSave||this.util.doAjaxPost("POST",this.model.serviceUrl+EJQueryEnum.ServiceAPI.deleteCustomConnector+"/"+this.customConnectorFileName,{},{});this.customConnectorFileName="";this.isDialogSave=!1},e.prototype.onCancelClick=function(){this.dialogContainer.ejDialog("close")},e.prototype.renderUploadBox=function(){var t=this,r=this.element.find("#"+this._id+"_fileDatasource_upload"),i,u;r.length>0&&r.remove();i=n.buildTag("div","",{height:"0px"},{id:this._id+"_fileDatasource_upload"});this.element.append(i);u=209715200;this.ejUploadBox=i.ejUploadbox({width:"0px",height:"0px",uploadName:"file",autoUpload:!0,showFileDetails:!1,dialogAction:{content:this.element},fileSize:u,saveUrl:this.model.serviceUrl+EJQueryEnum.ServiceAPI.uploadCustomConnectorJson+"/",fileSelect:$.proxy(this.onfileSelect,this),error:$.proxy(this.onuploadError,this),success:$.proxy(this.onuploadSuccess,this),inProgress:$.proxy(this.fileProgress,this),beforeSend:$.proxy(function(i){var r={headers:[],serverUrl:t.model.reportServerUrl,serviceAuthorizationToken:t.model.serviceAuthorizationToken};t.designerInstance.triggerEvents("ajaxBeforeLoad",r);n.isNullOrUndefined(r.serviceAuthorizationToken)||(i.xhr.setRequestHeader("serviceAuthorizationToken",r.serviceAuthorizationToken),i.xhr.setRequestHeader("ServerUrl",r.reportServerUrl))},this)}).data("ejUploadbox");this.element.find(this._id+"_fileDatasource_upload_SelectButton").hide()},e.prototype.onfileSelect=function(n){this.progressTxt.text("");n.files.length!==0&&(n.files[0].size>n.model.fileSize?(this.util.ejAlertDialog("Upload Error","The selected file exceeds the file size limit of "+n.model.fileSize/1048576+" MB",!1,!1,!0,"",null),n.cancel=!0,this.progressTxt.text("")):(this.filePath.val(n.files[0].name),this.progressTxt.text("Initiating upload...")))},e.prototype.fileProgress=function(n){this.progressTxt.text("Uploading"+n.percentage+"%")},e.prototype.onuploadError=function(){this.progressTxt.text("Upload failed");this.element.find("#"+this._id+"_progresserr_tr").css("display","none")},e.prototype.onuploadSuccess=function(n){var t=JSON.parse(n.responseText);t&&(t.status?(this.customConnectorFileName=t.data.fileName,this.saveButton.removeAttr("disabled"),this.progressTxt.text("Upload Completed")):(this.progressTxt.text("Upload failed"),this.util.ejAlertDialog("Upload Failed",t?t.message:null,!1,!1,!0,"",null)))},e.prototype.fetchCustomConnectors=function(){this.util.doAjaxPost("POST",this.model.serviceUrl+EJQueryEnum.ServiceAPI.loadCustomConnector,{},{fnction:$.proxy(this.updateCustomConnector,this)})},e.prototype.updateCustomConnector=function(t){var r=this.contentContainer.find(".e-rpt-tile-container[data-category="+i[3]+"]"),u,f;!t.status||n.isNullOrUndefined(t.data)||n.isNullOrUndefined(t.data.customConnectors)?this.renderAddButton(r,!0):(u=JSON.parse(t.data.customConnectors),f=this.GetNewConnectors(u),this.registerConnection(f),this.renderCustomConnectorTilesAfterFetch());r.css({"max-height":this.getContentHeight(r)+"px"})},e.prototype.registerConnection=function(t){n.isNullOrUndefined(t)||(this.availableDSList=this.availableDSList.concat(t))},e.prototype.renderCustomConnectorTilesAfterFetch=function(){this.totalTilesInfo=this.getTilesInfo();var t=this.getCategoryBasedTileInfo(i[3],this.totalTilesInfo),n=this.contentContainer.find(".e-rpt-tile-container[data-category="+i[3]+"]");t.filter(function(n){return n.switchBtnChkState===!1}).length>0?this.renderAddButton(n,!1):this.renderAddButton(n,!0);this.renderTiles(i[3],t,n,!0);this.updateDeleteIcon(n)},e.prototype.getTilesInfo=function(){return this.convertTilesInfoFormat(this.availableDSList)},e.prototype.updateDeleteIcon=function(n){var t=n.find(".e-custom-connector-delete"),i=n.find(".e-custom-connector-edit");i.off("click",$.proxy(this.onCustomConnectorEdit,this));i.on("click",$.proxy(this.onCustomConnectorEdit,this));t.off("click",$.proxy(this.onCustomConnectorDelete,this));t.on("click",$.proxy(this.onCustomConnectorDelete,this))},e.prototype.renderAddButton=function(n,t){var r=new f,u,e;r.category=i.CustomConnectors;r.isSwitchBtnDisable=!1;r.connector="Custom-Connector";r.iconClassName="";r.id="_customConnector";r.itemType="e-custom-connector";r.name="customConnector";r.switchBtnChkState=t;u=this.getTiles(r,!1,!0);e=u.find(".e-con-tile-configure-btn");e.html("Add New Connector");e.addClass("e-rpt-add-custom-container");u.find(".e-rpt-connection-img-tile").css({height:"calc(100% - 42px)",padding:"12px 72px"});u.css("height","150px");u.append("<div class='e-config-oauth-help-link-wrap '><div class='e-config-oauth-infoText'>Enable Custom Connectors<\/div><\/div>");u.addClass("e-custom-connector-add");n.append(u)},e.prototype.onAddButtonClick=function(){this.renderDialog("");this.ejUploadBox.model.saveUrl=this.model.serviceUrl+EJQueryEnum.ServiceAPI.uploadCustomConnectorJson+"/"},e.prototype.getDatasourceTypes=function(){return this.callback=$.proxy(this.datasourceCallback,this),this.designerInstance=this.initializeDesigner(),this.designerInstance.getDataSourceList(this.callback,null)},e.prototype.getNoItemMsg=function(){return"<div class='e-rpt-designer-datasource-search-no-data'>No data sources found<\/div>"},e.prototype.getDsItems=function(){var n=this.availableDSList,r=n,u,f,t,i,e;if(this.searchText.trim()!=="")for(n=this.filterCollection(r,"name",this.searchText),u=this.filterCollection(r,"tags",this.searchText),f=function(t){n.every(function(n){return n.name!==t.name})&&n.push(t)},t=0,i=u;t<i.length;t++)e=i[t],f(e);return n=this.sortCollection(n,"name")},e.prototype.sortCollection=function(n,t){return n.sort(function(n,i){return n[t]<i[t]?-1:n[t]>i[t]?1:0})},e.prototype.filterCollection=function(t,i,r,u){return t.filter(function(t){return u?t[i]===r:n.ReportUtil.contains(t[i],r,!0)})},e.prototype.wireEvents=function(){this.configurationContainer.on("click",".e-connection-configuration-content-container .e-category-icon",$.proxy(this.onCatergoryIconClick,this));this.configurationContainer.on("click",".e-connection-configuration-content-container .e-category-text-wrap",$.proxy(this.onCatergoryIconClick,this));this.configurationContainer.on("focusin",".e-connection-configuration-header .e-rpt-designer-datasource-search-container .e-rpt-designer-search-box",$.proxy(this.onDataSourceSearchTextFocusIn,this));this.configurationContainer.on("focusout",".e-connection-configuration-header .e-rpt-designer-datasource-search-container .e-rpt-designer-search-box",$.proxy(this.onDataSourceSearchTextFocusOut,this));this.configurationContainer.on("keyup",".e-connection-configuration-header .e-rpt-designer-datasource-search-container .e-autocomplete",$.proxy(this.onDataSourceSearchKeyPress,this));this.configurationContainer.on("click",".e-connection-configuration-header .e-rpt-designer-datasource-search-container .e-reportdesigner-close",$.proxy(this.onDataSourceClearIconClick,this));this.configurationContainer.on("click",".e-connection-configuration-content-container .e-rpt-add-custom-container",$.proxy(this.onAddButtonClick,this))},e.prototype.unwireEvents=function(){this.configurationContainer.off("click",".e-connection-configuration-content-container .e-category-icon",$.proxy(this.onCatergoryIconClick,this));this.configurationContainer.off("click",".e-connection-configuration-content-container .e-category-text-wrap",$.proxy(this.onCatergoryIconClick,this));this.configurationContainer.off("focusin",".e-connection-configuration-header .e-rpt-designer-datasource-search-container .e-rpt-designer-search-box",$.proxy(this.onDataSourceSearchTextFocusIn,this));this.configurationContainer.off("focusout",".e-connection-configuration-header .e-rpt-designer-datasource-search-container .e-rpt-designer-search-box",$.proxy(this.onDataSourceSearchTextFocusOut,this));this.configurationContainer.off("keyup",".e-connection-configuration-header .e-rpt-designer-datasource-search-container .e-autocomplete",$.proxy(this.onDataSourceSearchKeyPress,this));this.configurationContainer.off("click",".e-connection-configuration-header .e-rpt-designer-datasource-search-container .e-reportdesigner-close",$.proxy(this.onDataSourceClearIconClick,this));this.configurationContainer.off("click",".e-connection-configuration-content-container .e-rpt-add-custom-container",$.proxy(this.onAddButtonClick,this))},e.prototype.renderCheckBoxhButton=function(t,i){n.isNullOrUndefined(i)||(i.length===1&&i.children().length===0?(this.id=i.attr("id"),this.targetContainer=i,this.checkboxModel=t,this.renderEjCheckBox()):this.targetContainer.empty())},e.prototype.renderEjCheckBox=function(){var i;for(this.wrapper=n.buildTag("div.e-rpt-check-box-wrapper","",{},{}),this.targetContainer.append(this.wrapper),i=0;i<this.checkboxModel.dataSource.length;i++){var t=this.checkboxModel.dataSource[i],f=this.getId(t),u=n.buildTag("input.e-rpt-chk-input","",null,{id:f+"_chk_input",type:"checkbox"});this.wrapper.append(u);u.ejCheckBox({change:$.proxy(this.oncheckChange,this),name:t.name,text:n.isNullOrUndefined(t.label)?"":t.label,labelPosition:n.isNullOrUndefined(this.checkboxModel.labelPosition)?r[0]:this.checkboxModel.labelPosition[this.checkboxModel.labelPosition],checked:t.isChecked,enabled:t.isDisabled,cssClass:this.checkboxModel.cssClass,enableTriState:t.enableTriState})}},e.prototype.oncheckChange=function(t){var i,r,u;t&&t.isInteraction&&!n.isNullOrUndefined(this.checkboxModel.callBackInstance)&&!n.isNullOrUndefined(this.checkboxModel.callBackMethod)&&this.checkboxModel.callBackMethod!==""&&(i=[],r=[],this.contentContainer.find(".e-chkbox-wrap[aria-checked=true]").each(function(n,t){i.push($(t).find(".e-rpt-chk-input").attr("name"))}),this.contentContainer.find(".e-chkbox-wrap[aria-checked=false]").each(function(n,t){r.push($(t).find(".e-rpt-chk-input").attr("name"))}),u={checkedItems:i,uncheckedItems:r,event:t,arguments:this.checkboxModel.optionalArgs},this.checkBoxOnValueChange(u))},e.prototype.checkItemByName=function(t,i){var u=t.attr("data-category"),f=t.find("#"+this._id+"_chkbox_"+u+"_chk_input"),r=f.data("ejCheckBox");n.isNullOrUndefined(r)||r.option("checked",i)},e.prototype.intermediateStateByName=function(t,i){var u=t.attr("data-category"),f=t.find("#"+this._id+"_chkbox_"+u+"_chk_input"),r=f.data("ejCheckBox");n.isNullOrUndefined(r)||(r.option("enableTriState",i),r.option("checkState","indeterminate"))},e.prototype.disableItemByName=function(n,t){var i=this.targetContainer.find("#"+this._id+"_chkbox_"+n+"_chk_input"),r=i.data("ejCheckBox");this.disableCheckBox(r,t)},e.prototype.disableCheckBox=function(t,i){n.isNullOrUndefined(t)||t.option("enabled",!i)},e.prototype.GetNewConnectors=function(t){for(var u,f,e=[],o=["web","webapi"],r=0;r<t.length;r++)n.isNullOrUndefined(t[r].ConnectorInfo)||(u=t[r].ConnectorInfo,f={id:"_custom_webDs",src:"e-reportdesigner-datasource-webapi",itemType:"e-webapi",extType:"WebAPI",connector:"WebAPI_"+t[r].Name,description:t[r].Description,name:t[r].Name,tags:o.concat(u.Tags),category:DataSourceCategory.rest,connectorsCategory:i.CustomConnectors},e.push(f));return e},e.prototype.triggerEvents=function(n,t){var i,r=t;switch(n){case"ajaxBeforeLoad":i=this._trigger(n,r);break;case"ajaxSuccess":i=this._trigger(n,r);break;case"ajaxError":i=this._trigger(n,r)}},e}(n.WidgetBase);t.ejConnectionConfiguration=e;window.ej.widget("ejConnectionConfiguration","ej.ConnectionConfiguration",new n.Report.ejConnectionConfiguration)})(t=n.Report||(n.Report={}))})(ej||(ej={}))